# 聚合
>聚合返回基于query 查询的结果进行聚合计算后的数据。有以下四大类：
- 桶
>支持脚本。一些列构造桶的聚合，每个桶都与一个key和一个文档分类标准相关联。当聚合执行时，所有的文档分类标准(依据)对每个文档进行判断，将其分类到其满足的桶中。此类聚合执行的结果是：我们得到了桶的集合，每个桶内都含有满足该桶分类依据的文档。
>桶聚合可以有子聚合(桶聚合或者指标聚合)
- 指标
>支持脚本。能够跟踪聚合轨迹且在一系列文档上计算指标的聚合类型。
- 矩阵
>不支持脚本。可以在从请求文档内提取的多个字段值上操作并生成矩阵结果。
- 管道
>对其他聚合的结果和与其关联的指标进行聚合处理。

>聚合可以嵌套，可以在桶聚合中嵌套指标聚合，这是聚合的真正威力所在。
>聚合操作用于对double类型数据进行处理。因此，如果聚合操作用于绝对值大于2^53 的long型数据，聚合结果可能是近似值。

>聚合的结构
```sh
"aggregations" : {
    "<aggregation_name>" : {
        "<aggregation_type>" : {
            <aggregation_body>
        }
        [,"meta" : {  [<meta_data_body>] } ]?
        [,"aggregations" : { [<sub_aggregation>]+ } ]?
    }
    [,"<aggregation_name_2>" : { ... } ]*
}
```

